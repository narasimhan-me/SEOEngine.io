echo "ğŸ” Running pre-push checks..."

# Run linting on source files
echo "ğŸ“ Running linter on source files..."
cd apps/api
pnpm exec eslint "src/**/*.ts" --fix || {
  echo "âŒ Linting failed. Please fix the errors and try again."
  exit 1
}
cd ../..

# Run formatting check (if prettier is configured)
echo "ğŸ¨ Checking code formatting..."
if command -v prettier >/dev/null 2>&1 || pnpm exec prettier --version >/dev/null 2>&1; then
  pnpm exec prettier --check "apps/api/src/**/*.ts" "apps/web/src/**/*.{ts,tsx}" || {
    echo "âš ï¸  Code formatting issues found. Run 'pnpm format' to fix."
    # Don't fail on format, just warn
  }
else
  echo "âš ï¸  Prettier not found, skipping format check"
fi

# Run TypeScript type checks
echo "ğŸ”§ Running TypeScript type checks..."
cd apps/api
pnpm exec tsc --noEmit || {
  echo "âŒ TypeScript type check failed. Please fix the errors and try again."
  exit 1
}
cd ../..

# Run unit tests
echo "ğŸ§ª Running unit tests..."
pnpm test:unit || {
  echo "âŒ Unit tests failed. Please fix the failing tests and try again."
  exit 1
}

# Run critical integration tests
echo "ğŸ” Running critical integration tests..."
pnpm test:api:critical || {
  echo "âŒ Critical integration tests failed. Please fix the failing tests and try again."
  exit 1
}

echo "âœ… All pre-push checks passed!"

